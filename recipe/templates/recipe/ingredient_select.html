{% extends 'recipe/base.html' %}
{% load static %}
{% block title %}Select Ingredients{% endblock %}

{% block content %}
<section class="select-wrapper" style="display:flex; justify-content:center; align-items:flex-start; min-height:80vh; padding-top:50px; background-image: url('{% static "images/home_bg.jpg" %}'); background-size:cover; background-position:center;">
  <div class="select-card glass-medium" style="max-width:800px; width:100%; display:flex; flex-direction:column; padding:30px;">
    <h3>Select Ingredients You Have</h3>
    <p class="muted">Tick one or more ingredients to find matching recipes</p>

    <form method="post" action="{% url 'ingredient_select' %}">
      {% csrf_token %}
      <div class="form-grid" style="display:flex; gap:20px; flex-wrap:wrap;">

        <!-- Ingredients Checkboxes -->
        <div class="form-left" style="flex:1; max-height:300px; overflow-y:auto; border-right:1px solid rgba(255,255,255,0.3); padding-right:10px;">
          {% for checkbox in form.ingredients %}
            <div style="margin-bottom:5px;">
              <label>{{ checkbox.tag }} {{ checkbox.choice_label }}</label>
            </div>
          {% endfor %}
        </div>

        <!-- Servings & Meal Type -->
        <div class="form-right" style="flex:1; display:flex; flex-direction:column; gap:15px;">
          <label for="{{ form.servings.id_for_label }}">Servings</label>
          {{ form.servings }}

          <label for="{{ form.meal_type.id_for_label }}">Meal Type</label>
          {{ form.meal_type }}

          <div class="mt-3">
            <button class="btn vp-btn-primary w-100" type="submit">Find Recipes</button>
          </div>
        </div>
      </div>

      <!-- Live selected ingredients display -->
      <div id="selected-ingredients" class="mt-3" style="color:#ffd700; font-weight:bold;"></div>
    </form>
  </div>
</section>

<script>
  const checkboxes = document.querySelectorAll('input[type="checkbox"][name="ingredients"]');
  const displayDiv = document.getElementById('selected-ingredients');

  function updateSelectedIngredients() {
    const selected = [];
    checkboxes.forEach(cb => {
      if (cb.checked) {
        selected.push(cb.parentNode.textContent.trim());
      }
    });
    displayDiv.textContent = selected.length ? "Selected: " + selected.join(', ') : "";
  }

  checkboxes.forEach(cb => cb.addEventListener('change', updateSelectedIngredients));

  // Update on page load in case some checkboxes are pre-checked
  updateSelectedIngredients();
</script>
{% endblock %}
